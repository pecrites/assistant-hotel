<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Assistant H√¥tel ‚Äì Client</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #0b1f3a;
    color: white;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.container {
    text-align: center;
    width: 90%;
    max-width: 420px;
}
h1 {
    margin-bottom: 25px;
}
button {
    width: 100%;
    padding: 22px;
    font-size: 20px;
    border-radius: 50px;
    border: none;
    cursor: pointer;
    margin-bottom: 15px;
}
.btn-voice {
    background: #ffcc33;
    color: #000;
}
.btn-send {
    background: #4caf50;
    color: white;
}
.btn-confirm {
    background: #2196f3;
    color: white;
    display: none;
}
button:active {
    opacity: 0.85;
}
textarea, input {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 10px;
    border: none;
    font-size: 15px;
}
.small {
    font-size: 12px;
    opacity: 0.8;
    margin-top: 10px;
}
</style>
</head>

<body>

<div class="container">
    <h1>üé§ Parlez √† la r√©ception</h1>

    <!-- BOUTON VOCAL -->
    <button class="btn-voice" onclick="startVoice()">üéôÔ∏è APPUYER POUR PARLER</button>

    <!-- TEXTE OPTIONNEL -->
    <textarea id="text" rows="3" placeholder="Votre demande appara√Ætra ici"></textarea>
    <input id="room" placeholder="Num√©ro de chambre (ex : 203)">

    <!-- ENVOI -->
    <button class="btn-send" onclick="sendText()">üì® Envoyer la demande</button>

    <!-- CONFIRMATION VOCALE (FIABLE) -->
    <button id="confirmBtn" class="btn-confirm" onclick="playConfirmation()">
        üîä √âcouter la confirmation
    </button>

    <p class="small">
        Votre demande est transmise imm√©diatement √† la r√©ception
    </p>
</div>

<script>
let recognition;
let confirmationMessage = "";

// ==========================
// D√âMARRER LA VOIX (CLIENT)
// ==========================
function startVoice() {
    if (!('webkitSpeechRecognition' in window)) {
        alert("La reconnaissance vocale n'est pas support√©e sur ce navigateur");
        return;
    }

    recognition = new webkitSpeechRecognition();
    recognition.lang = "fr-FR";
    recognition.continuous = false;
    recognition.interimResults = false;

    // S√©curit√© : arr√™t auto apr√®s 6 secondes
    const stopTimer = setTimeout(() => recognition.stop(), 6000);

    recognition.onresult = (event) => {
        clearTimeout(stopTimer);
        const text = event.results[0][0].transcript;
        document.getElementById("text").value = text;
        recognition.stop();
    };

    recognition.onerror = () => {
        clearTimeout(stopTimer);
        recognition.stop();
    };

    recognition.start();
}

// ==========================
// ENVOI AU SERVEUR
// ==========================
async function sendText() {
    const text = document.getElementById("text").value.trim();
    const room = document.getElementById("room").value || "Inconnue";

    if (!text) {
        alert("Veuillez parler ou √©crire votre demande");
        return;
    }

    const response = await fetch("/api/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            room: room,
            text: text,
            lang: "fr"
        })
    });

    const data = await response.json();

    confirmationMessage = "Votre demande a bien √©t√© transmise √† la r√©ception.";
    document.getElementById("confirmBtn").style.display = "block";
    document.getElementById("text").value = "";
}

// ==========================
// CONFIRMATION VOCALE (100% FIABLE)
// ==========================
function playConfirmation() {
    if (!('speechSynthesis' in window)) {
        alert("Synth√®se vocale non support√©e");
        return;
    }

    const msg = new SpeechSynthesisUtterance(confirmationMessage);
    msg.lang = "fr-FR";
    msg.rate = 1;
    msg.pitch = 1;

    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(msg);
}
</script>

</body>
</html>
